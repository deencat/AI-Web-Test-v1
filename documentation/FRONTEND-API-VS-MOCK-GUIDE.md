# Frontend API vs Mock Data - Complete Guide

## üéØ How Frontend Determines Data Source

The frontend has **dual-mode capability**: it can use either **mock data** (for development/testing) or the **real backend API** (for integration/production).

---

## üîß Configuration

### Environment Variable (`.env` file)

The mode is controlled by the `VITE_USE_MOCK` environment variable in `frontend/.env`:

```bash
# frontend/.env
VITE_API_URL=http://localhost:8000
VITE_USE_MOCK=false    # ‚ö†Ô∏è CRITICAL: This line controls the mode!
```

### How It Works

**File:** `frontend/src/services/api.ts` (Line 5)

```typescript
const USE_MOCK_DATA = import.meta.env.VITE_USE_MOCK !== 'false'; // Default to true
```

**Logic:**
- If `VITE_USE_MOCK` is **not set** ‚Üí Uses **mock data** ‚ùå
- If `VITE_USE_MOCK=true` ‚Üí Uses **mock data** ‚ùå
- If `VITE_USE_MOCK=false` ‚Üí Uses **real API** ‚úÖ

**Default behavior:** Mock data is enabled unless explicitly disabled!

---

## üìä Services Affected

All services check `apiHelpers.useMockData()` before making API calls:

### 1. **Execution Service** (`executionService.ts`)
```typescript
async startExecution(testCaseId: number, request: ExecutionStartRequest) {
  if (apiHelpers.useMockData()) {
    // Returns fake execution ID
    return { id: Date.now(), status: 'pending', ... };
  }
  
  // Real API call
  const response = await api.post(`/tests/${testCaseId}/run`, request);
  return response.data;
}
```

**Impact:**
- ‚ùå Mock: Returns fake execution IDs, no real test runs
- ‚úÖ API: Actually queues and executes tests via Stagehand

### 2. **Test Service** (`testsService.ts`)
```typescript
async getTests(params: TestListParams) {
  if (apiHelpers.useMockData()) {
    // Returns hardcoded test list from mock/tests.ts
    return { data: mockTests, total: 5 };
  }
  
  // Real API call
  const response = await api.get('/tests', { params });
  return response.data;
}
```

**Impact:**
- ‚ùå Mock: Shows ~5 fake tests from `mock/tests.ts`
- ‚úÖ API: Shows real tests generated by backend

### 3. **Knowledge Base Service** (`knowledgeBaseService.ts`)
```typescript
async getDocuments(categoryId?: number) {
  if (apiHelpers.useMockData()) {
    // Returns fake documents
    return mockDocuments;
  }
  
  // Real API call
  const response = await api.get('/knowledge-base/documents', { params });
  return response.data;
}
```

**Impact:**
- ‚ùå Mock: Shows fake documents
- ‚úÖ API: Shows real uploaded documents from database

### 4. **Settings Service** (`settingsService.ts`)
```typescript
async getSettings() {
  if (apiHelpers.useMockData()) {
    // Returns fake settings
    return mockSettings;
  }
  
  // Real API call
  const response = await api.get('/settings');
  return response.data;
}
```

---

## üö® Current Status (After Fix)

### Before Fix
```bash
# frontend/.env
VITE_API_URL=http://localhost:8000
# ‚ùå Missing VITE_USE_MOCK=false ‚Üí Frontend used MOCK DATA!
```

### After Fix
```bash
# frontend/.env
VITE_API_URL=http://localhost:8000
VITE_USE_MOCK=false    # ‚úÖ Now using REAL BACKEND API!
```

---

## ‚úÖ Verification Checklist

### How to Confirm Frontend is Using Real API

1. **Check Environment File:**
   ```powershell
   cat frontend\.env
   ```
   Should show:
   ```
   VITE_API_URL=http://localhost:8000
   VITE_USE_MOCK=false
   ```

2. **Check Console Output:**
   - Open browser DevTools (F12)
   - Go to Console tab
   - You should see API requests:
   ```
   POST http://localhost:8000/api/v1/auth/login
   GET http://localhost:8000/api/v1/tests
   POST http://localhost:8000/api/v1/tests/1/run
   ```

3. **Check Network Tab:**
   - Open DevTools ‚Üí Network tab
   - Click "Generate Test" or "Run Test"
   - Look for requests to `localhost:8000`
   - **If using mock:** No network requests (instant response)
   - **If using API:** Network requests visible with real response times

4. **Functional Test:**
   - Run a test execution
   - **Mock mode:** Execution completes instantly with fake data
   - **API mode:** Execution takes 5-30 seconds, shows real browser automation

5. **Check Database:**
   ```powershell
   cd backend
   .\venv\Scripts\activate
   python -c "from app.database.session import engine; from sqlalchemy import text; print(engine.connect().execute(text('SELECT COUNT(*) FROM executions')).scalar())"
   ```
   - **Mock mode:** Count stays at 0
   - **API mode:** Count increases after running tests

---

## üêõ Troubleshooting

### Issue: Frontend still showing fake data

**Symptoms:**
- Tests generate instantly (no 5-10 second delay)
- Execution IDs are just timestamps (e.g., `1701619200000`)
- No entries in backend database
- No requests in Network tab

**Cause:** Frontend is still using mock data

**Fix:**
```powershell
# 1. Check .env file
cat frontend\.env

# 2. Add VITE_USE_MOCK=false if missing
echo "VITE_USE_MOCK=false" >> frontend\.env

# 3. RESTART frontend server (critical!)
# Stop the dev server (Ctrl+C)
cd frontend
npm run dev

# 4. Hard refresh browser (Ctrl+Shift+R)
```

### Issue: API calls failing

**Symptoms:**
- Console errors: "Failed to fetch"
- Network errors in DevTools
- Tests don't generate

**Cause:** Backend not running or wrong URL

**Fix:**
```powershell
# 1. Check backend is running
curl http://localhost:8000/docs
# Should return Swagger UI HTML

# 2. Check .env has correct URL
cat frontend\.env
# Should have: VITE_API_URL=http://localhost:8000

# 3. Restart backend if needed
cd backend
.\venv\Scripts\activate
python start_server.py
```

### Issue: CORS errors

**Symptoms:**
```
Access to fetch at 'http://localhost:8000/api/v1/tests' from origin 
'http://localhost:5173' has been blocked by CORS policy
```

**Fix:**
```powershell
# Check backend .env has CORS configured
cat backend\.env
# Should have:
# BACKEND_CORS_ORIGINS=["http://localhost:5173","http://localhost:3000"]
```

---

## üìã Integration Testing Impact

### With Mock Data (WRONG for integration)
- ‚ùå No real API calls
- ‚ùå No database changes
- ‚ùå No Playwright execution
- ‚ùå No screenshots captured
- ‚ùå Can't test backend integration
- ‚úÖ Useful for frontend UI testing only

### With Real API (CORRECT for integration)
- ‚úÖ Real API calls to backend
- ‚úÖ Database records created
- ‚úÖ Playwright executes tests
- ‚úÖ Screenshots captured in `backend/artifacts/`
- ‚úÖ Full end-to-end testing
- ‚úÖ Can verify Sprint 3 queue system

---

## üéØ Summary

**For Integration Testing (Sprint 3):**

```bash
# frontend/.env - MUST HAVE BOTH LINES:
VITE_API_URL=http://localhost:8000
VITE_USE_MOCK=false
```

**After changing `.env`:**
1. Restart frontend dev server (`Ctrl+C` then `npm run dev`)
2. Hard refresh browser (`Ctrl+Shift+R`)
3. Check Network tab to confirm API calls
4. Test generation should take 5-10 seconds (not instant)

**The setup script now automatically:**
- Checks if `VITE_USE_MOCK=false` exists
- Adds it if missing
- Warns if frontend .env needs updating

---

**Last Updated:** December 3, 2025  
**Branch:** `integration/sprint-3`  
**Status:** ‚úÖ Fixed - Frontend now uses real backend API
